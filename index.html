<script>
const params = new Proxy(new URLSearchParams(window.location.search), {
  get: (searchParams, prop) => searchParams.get(prop),
});

var url = params.server+"/optimized_route?json="+params.jsonString;
  
  const xhr = new XMLHttpRequest();  

  xhr.onreadystatechange = () => {
    if (xhr.readyState === 4) {
      var data = xhr.response;
      var b ="";
      for(var i of data.trip.locations){
        b+="\'"+i.lat+","+i.lon+"\'/";
      }
      b= "https://www.google.com/maps/dir/"+b;
      console.log(b);      
      xhr.send(b);
      window.location.replace(b);    

    }
  }

  xhr.open('GET', url, true);
  

  console.log(url);

  //xhr.open('GET', params.server+"/optimized_route?json="+params.jsonString, true);
  
  async function getUrl(url, callback){    
    
    const response = await fetch(url);
    var data = await response.json();
    var b ="";
    for(var i of data.trip.locations){
      b+="\'"+i.lat+","+i.lon+"\'/";
    }
    b= "https://www.google.com/maps/dir/"+b;
    console.log(b);
    xhr.send(b);
    callback(b);    
  }
  getUrl(url, redirect);
  function redirect(b){
    window.location.replace(b);
  }
  
</script>
